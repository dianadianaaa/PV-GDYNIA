<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Generator Ofert</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Fonts: Inter z polskimi znakami -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap&subset=latin-ext" rel="stylesheet">

  <!-- jsPDF + autotable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 40px;
      background: #f9fafb;
    }
    h1 { color: #005b41; }
    button {
      background: #005b41;
      border: none;
      color: white;
      padding: 10px 16px;
      margin: 6px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover { background: #017a58; }
  </style>
</head>
<body>
  <h1>Generator ofert</h1>
  <p>Przykładowa aplikacja do generowania ofert PDF (klient / biuro)</p>
  <button onclick="generujPDF('klient')">Generuj PDF dla klienta</button>
  <button onclick="generujPDF('biuro')">Generuj PDF dla biura</button>

<script>
/* ========= DANE PRZYKŁADOWE ========= */
let numerZapisanejOferty = null;
const daneOferty = {
  klient: { imie: "Jan Kowalski", adres: "ul. Leśna 12", kod: "33-100 Tarnów", telefon: "123456789", email: "jan.kowalski@email.com" },
  handlowiec: { imie: "Anna Nowak", teren: "Małopolska", telefon: "987654321", email: "anna.nowak@green-now.pl" },
  zestawPV: { text: "Zestaw Longi 525 + Inwerter DEYE SUN" },
  magazynNisko: { text: "Magazyn energii 10kWh" },
  magazynWysoko: { text: "-- Brak --" },
  dodatkiMagazyn: { text: "Magazyn ciepła 200l" },
  dodatkiModuly: { text: "-- Brak --" },
  turbinaWiatrowa: { text: "-- Brak --" },
  przekop: { value: "tak", text: "Przekop ziemny", dlugosc: 20, strona: "prawa" },
  samKabel: { cena: 500, text: "Przewód AC", dlugosc: 30 },
  klimatyzacja: { text: "-- Brak --" },
  wymianaFalownikMagazyn: { text: "NIE DOTYCZY" },
  modernizacjaRozdzielni: { price: 0 },
  inneDodatki: { nazwa: "System monitoringu", cena: 1200 },
  obliczenia: { marzaDlaPH: 1500, sumaNettoFinal: 25000, kwotaVat: 5750, cenaKoncowa: 30750 },
  stawkaVat: 0.23,
  infoDlaBiura: "Klient preferuje montaż w maju, instalacja dach skośny, pokrycie dachówką."
};

// Podmień to na swoje logo w base64 PNG
const LOGO_BASE64 = "data:image/png;base64,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";
/* ========= GENERATOR PDF ========= */
function generujPDF(typ) {
  if (!daneOferty.klient.imie) {
    alert("Proszę uzupełnić dane klienta.");
    return;
  }

  if (numerZapisanejOferty === null) {
    const d = new Date();
    numerZapisanejOferty = `GN/${d.getDate().toString().padStart(2,'0')}${(d.getMonth()+1).toString().padStart(2,'0')}${d.getFullYear()}/${String(Date.now()).slice(-4)}`;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  const W = doc.internal.pageSize.getWidth();
  const H = doc.internal.pageSize.getHeight();
  const M = 48;
  const zielony = [0,91,65];
  const fmtPLN = (v) => (Number(v)||0).toLocaleString('pl-PL',{style:'currency',currency:'PLN'});

  // Nagłówek
  if (LOGO_BASE64) doc.addImage(LOGO_BASE64, 'PNG', M, M-6, 120, 36);
  doc.setFont('Inter','bold'); doc.setFontSize(18); doc.setTextColor(...zielony);
  doc.text((typ==='klient')?'Oferta handlowa':'Podsumowanie dla biura', W-M, M+4, {align:'right'});
  doc.setFont('Inter','normal'); doc.setFontSize(10); doc.setTextColor(60);
  const dzis = new Date().toLocaleDateString('pl-PL');
  doc.text(`Numer: ${numerZapisanejOferty}`, W-M, M+22,{align:'right'});
  doc.text(`Data: ${dzis}`, W-M, M+36,{align:'right'});
  doc.setDrawColor(230); doc.line(M, M+50, W-M, M+50);

  // Dane stron
  let y = M+70;
  doc.setFont('Inter','bold'); doc.setFontSize(12); doc.setTextColor(...zielony);
  doc.text('Nabywca', M, y); doc.text('Sprzedawca', W/2, y);
  y+=16; doc.setFont('Inter','bold'); doc.setFontSize(11); doc.setTextColor(30);
  doc.text(daneOferty.klient.imie, M, y);
  doc.setFont('Inter','normal'); doc.setFontSize(10); doc.setTextColor(60);
  doc.text(`${daneOferty.klient.adres}, ${daneOferty.klient.kod}`, M, y+16);
  doc.text(`tel: ${daneOferty.klient.telefon}`, M, y+32);
  doc.text(`email: ${daneOferty.klient.email}`, M, y+48);

  const xR=W/2;
  doc.setFont('Inter','bold'); doc.text('GREEN NOW SP. Z O.O.', xR, y);
  doc.setFont('Inter','normal');
  doc.text(`Przedstawiciel: ${daneOferty.handlowiec.imie}`, xR, y+16);
  doc.text(`Teren: ${daneOferty.handlowiec.teren}`, xR, y+32);
  doc.text(`tel: ${daneOferty.handlowiec.telefon}`, xR, y+48);
  doc.text(`email: ${daneOferty.handlowiec.email}`, xR, y+64);
  y+=100;

  // Pozycje
  const pozycje=[];
  const pushIf=(k,o)=>{if(o && !['-- Wybierz --','-- Brak --','Brak','NIE DOTYCZY','NIE'].includes(o))pozycje.push([k,o]);};
  pushIf('Zestaw główny', daneOferty.zestawPV.text);
  pushIf('Magazyn NN', daneOferty.magazynNisko.text);
  pushIf('Magazyn ciepła', daneOferty.dodatkiMagazyn.text);
  pushIf('Przekop ziemny', `${daneOferty.przekop.text} (${daneOferty.przekop.dlugosc} m)` );
  pushIf('Dodatkowy kabel', `${daneOferty.samKabel.text} (${daneOferty.samKabel.dlugosc} m)` );
  pushIf('Inne dodatki', `${daneOferty.inneDodatki.nazwa} (${fmtPLN(daneOferty.inneDodatki.cena)})`);

  doc.setFont('Inter','bold'); doc.setFontSize(12); doc.setTextColor(...zielony);
  doc.text('Zakres prac i materiałów', M, y);
  doc.autoTable({
    startY:y+10,
    margin:{left:M,right:M},
    head:[['Kategoria','Opis']],
    body:pozycje,
    styles:{font:'Inter',fontSize:10,cellPadding:6,overflow:'linebreak'},
    headStyles:{fillColor:[244,247,246],textColor:[0,0,0],fontStyle:'bold'},
    columnStyles:{0:{cellWidth:160},1:{cellWidth:'auto'}}
  });
  y=doc.lastAutoTable.finalY+20;

  // Info dla biura
  if(typ==='biuro' && daneOferty.infoDlaBiura){
    doc.setFont('Inter','bold'); doc.setFontSize(12); doc.setTextColor(...zielony);
    doc.text('Informacje dla biura', M, y);
    doc.setFont('Inter','normal'); doc.setFontSize(10); doc.setTextColor(50);
    const wrap=doc.splitTextToSize(daneOferty.infoDlaBiura,W-2*M);
    doc.text(wrap, M, y+14); y+=14+wrap.length*12;
  }

  // Podsumowanie
  const rows=[];
  if(typ==='biuro'){rows.push(['Marża handlowca', fmtPLN(daneOferty.obliczenia.marzaDlaPH)]);}
  rows.push(['Wartość netto', fmtPLN(daneOferty.obliczenia.sumaNettoFinal)]);
  rows.push([`VAT ${(daneOferty.stawkaVat*100).toFixed(0)}%`, fmtPLN(daneOferty.obliczenia.kwotaVat)]);
  rows.push(['CENA BRUTTO', fmtPLN(daneOferty.obliczenia.cenaKoncowa)]);
  doc.setFont('Inter','bold'); doc.setFontSize(12); doc.setTextColor(...zielony);
  doc.text('Podsumowanie', M, Math.max(y,H-220));
  doc.autoTable({
    startY:Math.max(y+10,H-210),
    margin:{left:W-M-280,right:M},
    theme:'plain',
    body:rows,
    styles:{font:'Inter',fontSize:11,cellPadding:{top:2,bottom:2}},
    columnStyles:{0:{halign:'right'},1:{halign:'right',fontStyle:'bold'}}
  });

  // Stopka
  const strona=doc.getNumberOfPages();
  doc.setFont('Inter','normal'); doc.setFontSize(9); doc.setTextColor(120);
  doc.text(`Strona ${strona}`, W/2, H-20,{align:'center'});

  // Zapis
  doc.save(`Oferta_${numerZapisanejOferty.replace(/\//g,'-')}_${typ}.pdf`);
}
</script>
</body>
</html>
